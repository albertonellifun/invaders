<!DOCTYPE html>
<html lang="it">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, xxxmaximum-scale=1.0, xxxuser-scalable=no"/>
	<link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
	<title>Space Invaders - Apple ][ clone</title>
	<style>
		body {
			background:#000;
			color:#444;
			font-family:monospace;
			text-align:center;
			overflow: hidden;
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
		}
		h1, p {
			font-family: monospace;
			font-size: 12px;
		}
		h1, p, canvas {
			margin: 4px 0;
			padding: 4px;
			xxxborder: 3px solid #0f0;
			width: 600px;
		}
		canvas {
			image-rendering:pixelated;
			height: 400px;
		}
		#scanlines-overlay {
			position: absolute;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			pointer-events: none;
			background: repeating-linear-gradient(to right, transparent, transparent 0px, rgba(0, 0, 0, 0.33) 2px, transparent 4px);
			background-size: 100% 4px;
			opacity: 1;
			display:block;
			z-index: 10;
		}
	</style>
</head>
<body>
	<div id="scanlines-overlay"></div>

	<h1>Space Invaders - Apple ][ clone</h1>
	<canvas id="game" width="600" height="400"></canvas>
	<p>[P]lay/Pause - [R]eset - [X]scanLines - [C]olor change - [B]ackground change</p>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const WIDTH = 600;
const HEIGHT = 400;
const SCALE = 4;

let keys = {};
let frame = 0;

//GAME SETUP
let player = null;
let bunkers = [];
let aliens = [];
let bombs = [];
let particles = [];//pezzetti di player :-)
let stars = [];

let ufo = null;
let dir = 1;
let baseSpeed = 0.4;
let alienRowsCount = 6;
let alienColsCount = 8;
let groundExplosionTimer = 0;

let paused = false;//pause switch
let gameover = false;//gameover switch
let scanLinesEnabled = true;//scanlines switch
let last = performance.now();//LOOOOOOP

let currentColor = 0;//color change
const COLORS = [
	'#0f0',//verde
	'#fff',//bianco
	'#f80',//arancione
];
let currentBg = 0;//background cycle (0-none, 1-earth, 2-mountains)


//controlli
document.addEventListener("keydown", e => {
	keys[e.key] = true;
	
	if(e.key.toLowerCase() === "p") {
		//pause
		paused = !paused;
	}
	else if(e.key.toLowerCase() === "r") {
		//reset
		resetGame();
	}
	else if(e.key.toLowerCase() === "x") {
		//scanlines
		scanLinesEnabled = !scanLinesEnabled; 
		if (scanLinesEnabled) document.getElementById('scanlines-overlay').style.display = 'block';
		else document.getElementById('scanlines-overlay').style.display = 'none';
	}
	else if(e.key.toLowerCase() === "c") { 
		currentColor = (currentColor+1)%COLORS.length;
	}
	else if(e.key.toLowerCase() === "b") {
		//bg
		currentBg = (currentBg+1)%3;
	}
});
document.addEventListener("keyup", e => keys[e.key] = false);

//ALIENI REALI: 12x8 
//teschio piccolo real: 12x8
const alien1x = [
"000011111000",
"000111111100",
"001100100110",
"001111111110",
"000001110000",
"000010001000",
"000100000100",
"000011011000"];
const alien1y = [
"000011111000",
"000111111100",
"001100100110",
"001111111110",
"000001110000",
"000010001000",
"000100000100",
"001000000010"];
//capoccione real: 12x8
const alien2x = [
"001000001000",
"000100010000",
"001111111000",
"011011101100",
"111111111110",
"101111111010",
"101000001010",
"000110110000"];
const alien2y = [
"001000001000",
"100100010010",
"101111111010",
"011011101100",
"111111111110",
"001111111000",
"001000001000",
"010000000100"];
//triangolo real: 12x8
const alien3x = [
"000001100000",
"000011110000",
"000111111000",
"001101101100",
"001111111100",
"000010010000",
"000101101000",
"001010010100"];
const alien3y = [
"000001100000",
"000011110000",
"000111111000",
"001101101100",
"001111111100",
"000010010000",
"000100001000",
"000010010000"];
//teschio real: 12x8
const alien4x = [
"000011110000",
"011111111110",
"111111111111",
"111001100111",
"111111111111",
"000110011000",
"001001100100",
"000100001000"];
const alien4y = [
"000011110000",
"011111111110",
"111111111111",
"111001100111",
"111111111111",
"000110011000",
"001101101100",
"110000000011"];
//ufo real: 16x7
const ufoSprite1x = [
"0000011111100000",
"0001111111111000",
"0011111111111100",
"0110110110110110",
"1111111111111111",
"0011100110011100",
"0001000000001000"];
const ufoSprite1y = [
"0000011111100000",
"0001111111111000",
"0011111111111100",
"0101101101101110",
"1111111111111111",
"0011100110011100",
"0001000000001000"];

//ALIENI ALB: 8x6
//piccolo: 8x6
const alien1a = [
	"00111000",
	"01111100",
	"11011010",
	"11111110",
	"00100100",
	"01000010"];
const alien1b = [
	"00111000",
	"01111100",
	"11011010",
	"11111110",
	"01000010",
	"00100100"];
//capoccione: 8x6
const alien2a = [
	"00111100",
	"01111110",
	"11011101",
	"11111111",
	"01011010",
	"10100101"];
const alien2b = [
	"00111100",
	"01111110",
	"11011101",
	"11111111",
	"10100101",
	"01011010"];
//triangolo: 8x6
const alien3a = [
	"00011000",
	"00111100",
	"01111110",
	"11011011",
	"11111111",
	"01000010"];
const alien3b = [
	"00011000",
	"00111100",
	"01111110",
	"11011011",
	"11111111",
	"00100100"];
//alb teschio: 8x6
const alien4a = [
	"00011000",
	"01111110",
	"11011011",
	"11111111",
	"00100100",
	"01000010"];
const alien4b = [
	"00011000",
	"01111110",
	"11011011",
	"11111111",
	"01000010",
	"00100100"];
//alb hola: 8x6
const alien5a = [
	"10100101",
	"11111111",
	"11011011",
	"01111110",
	"00100100",
	"01000010"];
const alien5b = [
	"10100101",
	"11111111",
	"11011011",
	"01111110",
	"01000010",
	"00100100"];
//alb triangolo: 8x6 
const alien6a = [
	"00011000",
	"00111100",
	"01011010",
	"01111110",
	"01000010",
	"00100100"];
const alien6b = [
	"00011000",
	"00111100",
	"01011010",
	"01111110",
	"10011001",
	"01000010"];
//ufoSprite: 12x4
const ufoSprite1a = [
    "000111111000",
    "011111111110",
    "111011101111",
    "011111111110"];
const ufoSprite1b = [
    "000111111000",
    "011111111110",
    "110111011101",
    "011111111110"];
//player: 12x6 
const playerTankSprite = [
    "000001000000",
	"000011100000",
    "011111111100",
    "111111111110",
    "111111111110",
    "111111111110"];
//bunker: 16x10
const bunkerSprite = [
    "0011111111111100",
    "0111111111111110",
    "1111111111111111",
    "1111111111111111",
    "1111111111111111",
    "1111111111111111",
    "1111111111111111",
    "1111100000011111",
    "1111000000001111",
	"1110000000000111"];

	
const ufoSprites = [ ufoSprite1a, ufoSprite1b ];

const alienSprites = [
    [alien3a, alien3b],
	[alien5a, alien5b],
	[alien2a, alien2b],
	[alien4a, alien4b],
	[alien6a, alien6b],	
	[alien1a, alien1b]];


const ufoSpritesREAL = [ ufoSprite1x, ufoSprite1y ];
const alienSpritesREAL = [
    [alien3x, alien3y],
	[alien2x, alien2y],
	[alien4x, alien4y],
	[alien1x, alien1y]];



const bombSprite1a = [
	"010",
	"100",
	"010",
	"100"];
const bombSprite1b = [
	"100",
	"010",
	"100",
	"010"];
const bombSprite1c = [
	"010",
	"001",
	"010",
	"001"];
const bombSprite1d = [
	"001",
	"010",
	"001",
	"010"];
const bombSprites = [bombSprite1a, bombSprite1b, bombSprite1c, bombSprite1d];

const bulletSprite = ["010","000","010","010"];//bullet: 3x4


//disegna in modo quadrettoso [0=pixel spento, 1=pixel acceso]
function drawSprite(sprite, x, y){
  ctx.fillStyle = COLORS[currentColor];
  const rows = sprite.length;
  const cols = sprite[0].length;
  const offsetX = (cols * SCALE) / 2;
  const offsetY = (rows * SCALE) / 2;

  for(let r = 0; r < rows; r++) {
    for(let c = 0; c < cols; c++) {
      if(sprite[r][c] === "1") {
        ctx.fillRect(
		  x - offsetX + c * SCALE,//x centrato
          y - offsetY + r * SCALE,//y centrato
          SCALE,
          SCALE
        );
      }
    }
  }
}

//player terrestre incline ad esportare la democrazia nell'universo
class Player {
  constructor(x, y){
    this.x = x; 
	this.y = y; 
	this.alive = true; 
	this.bullet = null;
    this.sprite = playerTankSprite;
  }
  update(){
    if(!this.alive) return;
    if(keys["ArrowLeft"]) this.x -= 4;
    if(keys["ArrowRight"]) this.x += 4;
	if(this.x < 30) this.x = 30;
	if(this.x > WIDTH - 30) this.x = WIDTH - 30;
	
    if(keys[" "] && !this.bullet) this.bullet = {x:this.x, y:this.y};
    
	if(this.bullet){
      this.bullet.y -= 6;
	  //disegna bullet
	  drawSprite(bulletSprite, this.bullet.x, this.bullet.y);//bullet: 3x4
      if(this.bullet.y < 0) this.bullet = null;
    }
	//disegna cannone
    drawSprite(this.sprite, this.x, this.y);//player: 11x6
  }
}

//alieni cattivi ma stupidi
class Alien {
  constructor(x, y, sprite){
	this.x = x;
	this.y = y;
	this.sprite = sprite;
	this.alive = true;
	this.bombCooldown = Math.random() * 200;//timer casuale per sparo
	}
  	
  update(speed){ 
        if(!this.alive) return;
        this.x += speed;
        this.bombCooldown--;
        if(this.bombCooldown <= 0//posso sparare
			&& Math.abs(this.x - player.x) < 10 * SCALE//vedo il PLAYER sotto di me
			&& player.alive//il player non deve essere defunto!
			) {
			//posso sparare solo se sotto non ho altri alieni
			let isFirstRow = true;
			aliens.forEach(a=>{
				if(a.alive && Math.abs(a.x - this.x) < 10 * SCALE && a.y > this.y) {
					isFirstRow = false;
				}
			});
			if (isFirstRow) {
				bombs.push(new Bomb(this.x|0,this.y|0));
				this.bombCooldown = 100 + Math.random()*200;
			}
        }
		//disegna
		drawSprite(this.sprite[Math.floor(frame/20)%2], this.x, this.y);//alieno: 8x6
    }
}

//bunker terrestre
class Bunker {
  constructor(x){
    this.x = x; 
	this.y = HEIGHT - 70;
    this.mask = bunkerSprite.map(r=>r.split(""));//array di caratteri, le stringhe sono immutabili
	this.alive = true;
  }
  draw(){
    if(!this.alive) return;
    drawSprite(this.mask,this.x, this.y);
  }

  hit(px, py, radius){
    if(!this.alive) return false;
    let hitSomething = false;

    // offset per centro bunker
    const offsetX = (this.mask[0].length * SCALE) / 2;
    const offsetY = (this.mask.length * SCALE) / 2;

    const cx = Math.floor((px - (this.x - offsetX)) / SCALE);
    const cy = Math.floor((py - (this.y - offsetY)) / SCALE);

    for(let y = -radius; y <= radius; y++){
        for(let x = -radius; x <= radius; x++){
            if(x*x + y*y > radius*radius) continue;
            const bx = cx + x;
            const by = cy + y;
            if(
                by >= 0 && by < this.mask.length &&
                bx >= 0 && bx < this.mask[by].length &&
                this.mask[by][bx] === "1"
            ){
                this.mask[by][bx] = "0";
                hitSomething = true;
            }
        }
    }
    return hitSomething;
  }
}

//bombette aliene
class Bomb {
    constructor(x,y){
        this.x = x; 
		this.y = y;
        this.sprite = bombSprites;
		this.alive = true;
    }
    update(){
	    if(this.y > HEIGHT) this.alive = false;
		if(!this.alive) return;
        
		this.y += 3;
        
		//disegna
		drawSprite(this.sprite[Math.floor(frame/5)%4], this.x, this.y);//bomb: 3x4
		
        // collision player 12x6
        if(player.alive && Math.abs(this.x - player.x) <= 6 * SCALE && Math.abs(this.y - player.y)<= 3 * SCALE) {
			doExplode(player.x, player.y, 40);
			player.alive = false;
			setTimeout(function(){ player.alive = true;},3000);
		}
		
        // collision bunker
        bunkers.forEach(b=>{ 
			if(b.hit(this.x, this.y, 3)) {
				this.alive=false; 
			}
		});
    }
}

//UFO
class UFO {
    constructor(){ 
		this.x = -60; 
		this.y = 15; 
		this.sprite = ufoSprites;
		this.alive = true;
	}
    update(){
		if(!this.alive) return;
        
		this.x += 2;
        
		//collisione bullet 12x4
		if(player.bullet && Math.abs(player.bullet.x - this.x) <= 6 * SCALE && Math.abs(player.bullet.y - this.y) <= 2 * SCALE){
			doExplode(this.x, this.y, 40);
            this.alive = false; 
			player.bullet = null;
        }
		
        if(this.x > WIDTH) this.alive = false;
		
		//disegna
		drawSprite(this.sprite[Math.floor(frame/10)%2], this.x, this.y);//ufo: 12x4
    }
}


//esplosioni
class Particle {
    constructor(x,y,vx,vy,life){
      this.x = x; 
	  this.y = y; 
	  this.vx = vx; 
	  this.vy = vy; 
	  this.life = life;
    }
    update(dt){
      if(this.life <= 0 || this.x < 0 || this.x > WIDTH || this.y < 0 || this.y > HEIGHT) return;
	  this.x = this.x + this.vx*dt;
      this.y = this.y + this.vy*dt;
      this.life -= dt;
	  //disegna
      ctx.fillRect(this.x - 2, this.y - 2, 4, 4);//particle: 4x4
    }
  }


//kaboom
function doExplode(x,y,qty){
	for(let i=0;i<qty;i++){
		const a = Math.random() * Math.PI*2;
		const sp = Math.random() * 120 + qty;
		const vx = Math.cos(a)*sp;
		const vy = Math.sin(a)*sp;
		const life = qty * Math.random() / 40;
		particles.push(new Particle(x, y, vx, vy, life));
	}
}


//stelline in cielo 
class Star {
    constructor(x, y, size) {
		this.x = x;
		this.y = y;
		this.size = size;
	}
	
	draw(ctx) {
		ctx.fillRect(this.x, this.y, this.size, this.size);
	}
}


//background stellare
function spawnStars(count) {
	for(let i=0; i < count; i++) {
		stars.push(new Star((Math.random()*WIDTH)|0, (Math.random()*HEIGHT*3/4)|0 ,Math.random()<0.2?2:1));
	}
}


//saturno
function drawSaturnSlice() {
	const cx = WIDTH + 1;   // centro fuori dallo schermo a destra
	const cy = -1;      // centro fuori in alto
	const r  = 70;
	
	ctx.strokeStyle = COLORS[currentColor];
	
	//pianeta
	const gradPlanet = ctx.createLinearGradient(cx-r, 0, cx, r);
	gradPlanet.addColorStop(0, 'rgba(0,0,0,1)');
	gradPlanet.addColorStop(1, currentColor == 0 ? 'rgba(0,140,0,0.1)' 
						: currentColor == 1 ? 'rgba(140,140,140,0.1)'
						: 'rgba(140,0,0,0.1)'
						);
	ctx.fillStyle = gradPlanet;
  
	ctx.beginPath();
	ctx.moveTo(cx, cy);
	ctx.arc( cx, cy, r, Math.PI / 2, Math.PI );
	ctx.closePath();
	ctx.stroke();
	ctx.fill();
  
  
	//ANELLI
	const gradRings = ctx.createLinearGradient(0, 0, 0, r);
	gradRings.addColorStop(0, 'rgba(0,0,0,1)');
	gradRings.addColorStop(1, currentColor == 0 ? 'rgba(0,140,0,0.1)' 
						: currentColor == 1 ? 'rgba(140,140,140,0.1)'
						: 'rgba(140,0,0,0.1)'
						);
	ctx.fillStyle = gradRings;

	ctx.beginPath();
	// ellisse esterna
	ctx.ellipse( cx, cy, r * 1.4, r * 0.35, -0.3, Math.PI * 0.5, Math.PI * 1.26 );
	
	// ellisse interna (inverso!)
	ctx.ellipse( cx, cy, r * 1.1, r * 0.28, -0.3, Math.PI * 1.15, Math.PI * 0.5, true );
	
	ctx.closePath();
	ctx.stroke();
	ctx.fill();
}


//pianeta terra
function drawEarthGlobe(){
	if(currentBg === 0) return;
	
	const planetX = WIDTH / 2;
	const planetY = HEIGHT * 20;
	const planetR = HEIGHT * 19.2;
	const startA = Math.PI * 1.48;
	const endA   = Math.PI * 1.52;
	
	ctx.strokeStyle = COLORS[currentColor];
	
	const grad = ctx.createLinearGradient(0, 300, 0, 400);
	grad.addColorStop(0, 'rgba(0,0,0,1)');
	grad.addColorStop(1, currentColor == 0 ? 'rgba(0,140,0,0.1)' 
						: currentColor == 1 ? 'rgba(140,140,140,0.1)'
						: 'rgba(140,0,0,0.1)'
						);
	ctx.fillStyle = grad;
	
	//aggiungo saturno per la libidine totale
	drawSaturnSlice();
	
	if (currentBg === 1) {
		//bordo pianeta
		ctx.beginPath();
		ctx.moveTo(-1, 325);
		ctx.arc(
			planetX,
			planetY,
			planetR,
			startA,
			endA
		);
		ctx.lineTo(601,325);
		ctx.lineTo(601,401);
		ctx.lineTo(-1,401);
		ctx.closePath();
		ctx.fill();
		ctx.stroke();
	}
  
	if (currentBg === 2) {
		//montagne
		ctx.beginPath();
		const steps = 40;
		
		ctx.moveTo(-1, 325);
		for(let i = 0; i <= steps; i++){
			const t = i / steps;
			const a = startA + (endA - startA) * t;
			
			// punto base sull'arco
			const x = planetX + Math.cos(a) * planetR;
			const y = planetY + Math.sin(a) * planetR;
			
			// altezza montagna
			const h = Math.sin(x * 0.02) * 12 +
				Math.sin(x * 0.05) * 5;
			
			// normale all'arco (verso l'alto)
			const nx = Math.cos(a);
			const ny = Math.sin(a);
			
			const mx = x + nx * h;
			const my = y + ny * h;

			ctx.lineTo(mx, my);
		}
		ctx.lineTo(601,335);
		ctx.lineTo(601,401);
		ctx.lineTo(-1,401);
		ctx.closePath();
		ctx.fill();
		ctx.stroke();
	}
	ctx.fillStyle=COLORS[currentColor];//ripristina fill
}


//reset
function resetGame() {
    //player
	player = new Player(WIDTH * 2 / 5, HEIGHT - 20);
    
    //bunker
    bunkers = [];
	for(let i = 1; i < 4; i++) {
		bunkers.push(new Bunker(i * WIDTH / 4));
	}

    //alieni
    aliens = [];
    for(let row = 0; row < alienRowsCount; row++){
		let sprit = alienSprites[row % alienSprites.length];
		let hsize = sprit[0][0].length;
		let vsize = sprit[0].length;
        for(let col = 0; col < alienColsCount; col++){
			let ax = 80 + col * SCALE * (hsize + 2);//8px + 2 di gap//12px
            let ay = 40 + row * SCALE * (vsize + 2);//6px + 2 di gap//8px
            aliens.push(new Alien(ax, ay, sprit));
        }
    }

	//UFO
    ufo = null;
	
    //bombe
    bombs = [];
	
	//particelle
    particles = [];

	//stelline
	stars = [];
	spawnStars(WIDTH / 5);
	
    //direzione e frame
    dir = 1;
    frame = 0;
	
	gameover = false;
	paused = false;
}


function loop(now) {
	const dt = Math.min(1/30, (now-last)/1000); 
	last = now;

	//GAMEOVER
	if (gameover) { 
		ctx.clearRect(0,0,WIDTH,HEIGHT);
		
		//stelle
		stars.forEach(s => s.draw(ctx));
		
		//pianeta terra
		drawEarthGlobe();
		
		//alieni
		aliens.forEach(a => {
			if(!a.alive) return;
			a.update(0);
		});
		
		//ufo
		ufo = new UFO();
		ufo.x = WIDTH / 2;
		ufo.update();
		
		//particelle
		particles.forEach(p => p.update(dt));
		
		groundExplosionTimer -= dt;
		
		if(groundExplosionTimer <= 0) {
			groundExplosionTimer = 0.1; //frequenza
			const x = Math.random() * WIDTH;
			const y = HEIGHT - 10;
			doExplode(x, y, 40);
		}
		
		ctx.font = '96px monospace';
		ctx.textAlign = 'center';
		ctx.fillText('GAME OVER', WIDTH/2, HEIGHT/2);
		
		frame++;
	}
  
	//GAME...
	if (!paused && !gameover) {
		ctx.clearRect(0,0,WIDTH,HEIGHT);
		
		//stelle
		stars.forEach(s => s.draw(ctx));
		
		//pianeta terra
		drawEarthGlobe();
		
		const alive = aliens.filter(a=>a.alive).length;
		const speed = baseSpeed + (alienRowsCount * alienColsCount - alive) * 0.05;
		let edge = false;
		
		//WINNER
		if (alive == 0) {
			ctx.font = '96px monospace';
			ctx.textAlign = 'center';
			ctx.fillText('YOU WIN!', WIDTH/2, HEIGHT/2);
		}
		
		
		//alieni
		aliens.forEach(a => {
			if(!a.alive) return;
			a.update(speed*dir);
			if(a.x<30 || a.x>(WIDTH-30)) edge=true;
			
			//alieno morto
			if(player.bullet && Math.abs(player.bullet.x - a.x) < 8 * SCALE && Math.abs(player.bullet.y - a.y) < 6 * SCALE	 ) {
				doExplode(a.x, a.y, 10);
				a.alive = false;
				player.bullet = null;
			}
			
			//bunker distrutto quando un alieno scende troppo
			bunkers.forEach(b=>{
				if(b.alive && Math.abs(a.y - b.y) < 10 * SCALE) b.alive = false;// bunker sparisce proprio
			});
	  
			//terra distrutta quando un alieno scende troppo
			if(a.y > HEIGHT - 25) {
				player.alive = false;
				gameover = true;
				doExplode(player.x, player.y, 40);
			}
		});
	
		//alieni toccano bordo -> invertire rotta, aumentare velocita :-)
		if(edge){
			dir*=-1; 
			aliens.forEach(a => a.y += 10);
		}
	
		//player spara al bunker :(
		if(player.bullet) {
			bunkers.forEach(b => {
				if(player.bullet && b.hit(player.bullet.x, player.bullet.y, 1)) {
					player.bullet = null;
				}
			});
		}
		
		//player puo' sparare alle bombette e distruggerle!!!
		if(player.bullet) {
			bombs.forEach(b => {
				if(player.bullet && Math.abs(player.bullet.x - b.x) <= 4 && Math.abs(player.bullet.y - b.y) <= 4) {
					player.bullet = null;
					b.alive = false;
					doExplode(b.x, b.y, 10);
				}
			});
		}
	
		//disegno bunker
		bunkers.forEach(b => b.draw());

		//disegno player
		player.update();
	
		//bombe alieni
		bombs.forEach(b => b.update());
		for(let i = bombs.length - 1; i >= 0; i--) if(!bombs[i].alive) bombs.splice(i,1);

		//UFO
		if(!ufo && Math.random()<0.002 && alive > 0) ufo = new UFO();
		if(ufo){
			ufo.update();
			if(!ufo.alive) ufo=null;
		}
	
		//particelle
		particles.forEach(p=>p.update(dt));
	
		frame++;
	}
	
	requestAnimationFrame(loop);
}

resetGame();

requestAnimationFrame(loop);
</script>
</body>
</html>